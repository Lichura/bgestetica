!function(){function e(){for(var e=scheduler.get_visible_events(),t=[],s=0;s<this.y_unit.length;s++)t[s]=[];for(t[r]||(t[r]=[]),s=0;s<e.length;s++){for(var r=this.order[e[s][this.y_property]],a=0;this._trace_x[a+1]&&e[s].start_date>=this._trace_x[a+1];)a++;for(;this._trace_x[a]&&e[s].end_date>this._trace_x[a];)t[r][a]||(t[r][a]=[]),t[r][a].push(e[s]),a++}return t}function t(e){for(var t=0,s=this._trace_x;t<s.length-1&&+e>=+s[t+1];)t++;return t}function s(e,s,r){var a=0,l=r._step,d=r.round_position,_=0,i=s?e.end_date:e.start_date;i.valueOf()>scheduler._max_date.valueOf()&&(i=scheduler._max_date);var h=i-scheduler._min_date_timeline;if(h>0){for(var c=t.call(r,i),n=0;n<c;n++)a+=scheduler._cols[n];var u=scheduler.date.add(scheduler._min_date_timeline,scheduler.matrix[scheduler._mode].x_step*c,scheduler.matrix[scheduler._mode].x_unit);d?+i>+u&&s&&(_=scheduler._cols[c]):(h=i-u,_=Math.round(h/l))}return a+=s?0==h||d?_-14:_-12:_+1}function r(e,s){var r=t.call(this,e),a=this._trace_x[r];return s&&+e!=+this._trace_x[r]&&(a=this._trace_x[r+1]?this._trace_x[r+1]:scheduler.date.add(this._trace_x[r],this.x_step,this.x_unit)),new Date(a)}function a(e){var t="";if(e&&"cell"!=this.render){e.sort(this.sort||function(e,t){return e.start_date.valueOf()==t.start_date.valueOf()?e.id>t.id?1:-1:e.start_date>t.start_date?1:-1});for(var s=[],a=e.length,l=0;l<a;l++){var d=e[l];d._inner=!1;var _=this.round_position?r.apply(this,[d.start_date,!1]):d.start_date;for(this.round_position?r.apply(this,[d.end_date,!0]):d.end_date;s.length;){if(!(s[s.length-1].end_date.valueOf()<=_.valueOf()))break;s.splice(s.length-1,1)}for(var i=!1,h=0;h<s.length;h++){var c=s[h];if(c.end_date.valueOf()<=_.valueOf()){i=!0,d._sorder=c._sorder,s.splice(h,1),d._inner=!0;break}}if(s.length&&(s[s.length-1]._inner=!0),!i)if(s.length)if(s.length<=s[s.length-1]._sorder){if(s[s.length-1]._sorder)for(var n=0;n<s.length;n++){for(var u=!1,o=0;o<s.length;o++)if(s[o]._sorder==n){u=!0;break}if(!u){d._sorder=n;break}}else d._sorder=0;d._inner=!0}else{u=s[0]._sorder;for(var x=1;x<s.length;x++)s[x]._sorder>u&&(u=s[x]._sorder);d._sorder=u+1,d._inner=!1}else d._sorder=0;s.push(d),s.length>(s.max_count||0)?(s.max_count=s.length,d._count=s.length):d._count=d._count?d._count:1}for(var m=0;m<e.length;m++)e[m]._count=s.max_count;for(var f=0;f<a;f++)t+=scheduler.render_timeline_event.call(this,e[f],!1)}return t}function l(t){var s="<table style='table-layout:fixed;' cellspacing='0' cellpadding='0'>",r=[];if(scheduler._load_mode&&scheduler._load(),"cell"==this.render)r=e.call(this);else for(var l=scheduler.get_visible_events(),d=this.order,_=0;_<l.length;_++){var i=l[_],h=i[this.y_property],c=this.order[h];if(this.show_unassigned&&!h){for(var n in d)if(d.hasOwnProperty(n)){r[c=d[n]]||(r[c]=[]);var u=scheduler._lame_copy({},i);u[this.y_property]=n,r[c].push(u)}}else r[c]||(r[c]=[]),r[c].push(i)}for(var o=0,x=0;x<scheduler._cols.length;x++)o+=scheduler._cols[x];var m=new Date;this._step=m=(scheduler.date.add(m,this.x_step*this.x_size,this.x_unit)-m)/o,this._summ=o;var f=scheduler._colsS.heights=[];for(this._events_height={},this._section_height={},x=0;x<this.y_unit.length;x++){var v=this._logic(this.render,this.y_unit[x],this);scheduler._merge(v,{height:this.dy}),this.section_autoheight&&(this.y_unit.length*v.height<t.offsetHeight&&(v.height=Math.max(v.height,Math.floor((t.offsetHeight-1)/this.y_unit.length))),this._section_height[this.y_unit[x].key]=v.height),scheduler._merge(v,{tr_className:"",style_height:"height:"+v.height+"px;",style_width:"width:"+(this.dx-1)+"px;",td_className:"dhx_matrix_scell"+(scheduler.templates[this.name+"_scaley_class"](this.y_unit[x].key,this.y_unit[x].label,this.y_unit[x])?" "+scheduler.templates[this.name+"_scaley_class"](this.y_unit[x].key,this.y_unit[x].label,this.y_unit[x]):""),td_content:scheduler.templates[this.name+"_scale_label"](this.y_unit[x].key,this.y_unit[x].label,this.y_unit[x]),summ_width:"width:"+o+"px;",table_className:""});var g=a.call(this,r[x]);if(this.fit_events){var p=this._events_height[this.y_unit[x].key]||0;v.height=p>v.height?p:v.height,v.style_height="height:"+v.height+"px;",this._section_height[this.y_unit[x].key]=v.height}if(s+="<tr class='"+v.tr_className+"' style='"+v.style_height+"'><td class='"+v.td_className+"' style='"+v.style_width+" height:"+(v.height-1)+"px;'>"+v.td_content+"</td>","cell"==this.render)for(_=0;_<scheduler._cols.length;_++)s+="<td class='dhx_matrix_cell "+scheduler.templates[this.name+"_cell_class"](r[x][_],this._trace_x[_],this.y_unit[x])+"' style='width:"+(scheduler._cols[_]-1)+"px'><div style='width:"+(scheduler._cols[_]-1)+"px'>"+scheduler.templates[this.name+"_cell_value"](r[x][_])+"</div></td>";else{for(s+="<td><div style='"+v.summ_width+" "+v.style_height+" position:relative;' class='dhx_matrix_line'>",s+=g,s+="<table class='"+v.table_className+"' cellpadding='0' cellspacing='0' style='"+v.summ_width+" "+v.style_height+"' >",_=0;_<scheduler._cols.length;_++)s+="<td class='dhx_matrix_cell "+scheduler.templates[this.name+"_cell_class"](r[x],this._trace_x[_],this.y_unit[x])+"' style='width:"+(scheduler._cols[_]-1)+"px'><div style='width:"+(scheduler._cols[_]-1)+"px'></div></td>";s+="</table>",s+="</div></td>"}s+="</tr>"}s+="</table>",this._matrix=r,t.innerHTML=s,scheduler._rendered=[];var y=scheduler._obj.getElementsByTagName("DIV");for(x=0;x<y.length;x++)y[x].getAttribute("event_id")&&scheduler._rendered.push(y[x]);for(this._scales={},x=0;x<t.firstChild.rows.length;x++){f.push(t.firstChild.rows[x].offsetHeight);var k=this.y_unit[x].key,b=this._scales[k]=scheduler._isRender("cell")?t.firstChild.rows[x]:t.firstChild.rows[x].childNodes[1].getElementsByTagName("div")[0];scheduler.callEvent("onScaleAdd",[b,k])}}function d(e){var t=scheduler.xy.scale_height,s=this._header_resized||scheduler.xy.scale_height;scheduler._cols=[],scheduler._colsS={height:0},this._trace_x=[];var r=scheduler._x-this.dx-18,a=[this.dx];scheduler._els.dhx_cal_header[0].style.width=a[0]+r+"px";for(var l=scheduler._min_date_timeline=scheduler._min_date,d=0;d<this.x_size;d++)this._trace_x[d]=new Date(l),l=scheduler.date.add(l,this.x_step,this.x_unit),scheduler._cols[d]=Math.floor(r/(this.x_size-d)),r-=scheduler._cols[d],a[d+1]=a[d]+scheduler._cols[d];if(e.innerHTML="<div></div>",this.second_scale){for(var i=this.second_scale.x_unit,h=[this._trace_x[0]],c=[],n=[this.dx,this.dx],u=0,x=0;x<this._trace_x.length;x++){var m=this._trace_x[x];_(i,m,h[u])&&(h[++u]=m,n[u+1]=n[u]);var f=u+1;c[u]=scheduler._cols[x]+(c[u]||0),n[f]+=scheduler._cols[x]}e.innerHTML="<div></div><div></div>";var v=e.firstChild;v.style.height=s+"px",e.lastChild.style.position="relative";for(var g=0;g<h.length;g++){var p=h[g],y=scheduler.templates[this.name+"_second_scalex_class"](p),k=document.createElement("DIV");k.className="dhx_scale_bar dhx_second_scale_bar"+(y?" "+y:""),scheduler.set_xy(k,c[g]-1,s-3,n[g],0),k.innerHTML=scheduler.templates[this.name+"_second_scale_date"](p),v.appendChild(k)}}scheduler.xy.scale_height=s;e=e.lastChild;for(var b=0;b<this._trace_x.length;b++){l=this._trace_x[b],scheduler._render_x_header(b,a[b],l,e);var w=scheduler.templates[this.name+"_scalex_class"](l);w&&(e.lastChild.className+=" "+w)}scheduler.xy.scale_height=t;var E=this._trace_x;e.onclick=function(e){var t=o(e);t&&scheduler.callEvent("onXScaleClick",[t.x,E[t.x],e||event])},e.ondblclick=function(e){var t=o(e);t&&scheduler.callEvent("onXScaleDblClick",[t.x,E[t.x],e||event])}}function _(e,t,s){switch(e){case"hour":return t.getHours()!=s.getHours()||_("day",t,s);case"day":return!(t.getDate()==s.getDate()&&t.getMonth()==s.getMonth()&&t.getFullYear()==s.getFullYear());case"week":return!(scheduler.date.getISOWeek(t)==scheduler.date.getISOWeek(s)&&t.getFullYear()==s.getFullYear());case"month":return!(t.getMonth()==s.getMonth()&&t.getFullYear()==s.getFullYear());case"year":return t.getFullYear()!=s.getFullYear();default:return!1}}function i(e){if(e){scheduler.set_sizes(),n();var t=scheduler._min_date;d.call(this,scheduler._els.dhx_cal_header[0]),l.call(this,scheduler._els.dhx_cal_data[0]),scheduler._min_date=t,scheduler._els.dhx_cal_date[0].innerHTML=scheduler.templates[this.name+"_date"](scheduler._min_date,scheduler._max_date),scheduler.markNow&&scheduler.markNow()}h()}function h(){scheduler._tooltip&&(scheduler._tooltip.style.display="none",scheduler._tooltip.date="")}function c(e,t,s){if("cell"==e.render){var r=t.x+"_"+t.y,a=e._matrix[t.y][t.x];if(!a)return h();if(a.sort(function(e,t){return e.start_date>t.start_date?1:-1}),scheduler._tooltip){if(scheduler._tooltip.date==r)return;scheduler._tooltip.innerHTML=""}else{var l=scheduler._tooltip=document.createElement("DIV");l.className="dhx_year_tooltip",document.body.appendChild(l),l.onclick=scheduler._click.dhx_cal_data}for(var d="",_=0;_<a.length;_++){var i=a[_].color?"background-color:"+a[_].color+";":"",c=a[_].textColor?"color:"+a[_].textColor+";":"";d+="<div class='dhx_tooltip_line' event_id='"+a[_].id+"' style='"+i+c+"'>",d+="<div class='dhx_tooltip_date'>"+(a[_]._timed?scheduler.templates.event_date(a[_].start_date):"")+"</div>",d+="<div class='dhx_event_icon icon_details'>&nbsp;</div>",d+=scheduler.templates[e.name+"_tooltip"](a[_].start_date,a[_].end_date,a[_])+"</div>"}scheduler._tooltip.style.display="",scheduler._tooltip.style.top="0px",scheduler._tooltip.style.left=document.body.offsetWidth-s.left-scheduler._tooltip.offsetWidth<0?s.left-scheduler._tooltip.offsetWidth+"px":s.left+t.src.offsetWidth+"px",scheduler._tooltip.date=r,scheduler._tooltip.innerHTML=d,scheduler._tooltip.style.top=document.body.offsetHeight-s.top-scheduler._tooltip.offsetHeight<0?s.top-scheduler._tooltip.offsetHeight+t.src.offsetHeight+"px":s.top+"px"}}function n(){dhtmlxEvent(scheduler._els.dhx_cal_data[0],"mouseover",function(e){var t=scheduler.matrix[scheduler._mode];if(t&&"cell"==t.render){if(t){var s=scheduler._locate_cell_timeline(e);(e=e||event).target||e.srcElement;if(s)return c(t,s,getOffset(s.src))}h()}}),n=function(){}}function u(e){for(var t=e.parentNode.childNodes,s=0;s<t.length;s++)if(t[s]==e)return s;return-1}function o(e){for(var t=(e=e||event).target?e.target:e.srcElement;t&&"DIV"!=t.tagName;)t=t.parentNode;if(t&&"DIV"==t.tagName&&"dhx_scale_bar"==t.className.split(" ")[0])return{x:u(t),y:-1,src:t,scale:!0}}scheduler.matrix={},scheduler._merge=function(e,t){for(var s in t)"undefined"==typeof e[s]&&(e[s]=t[s])},scheduler.createTimelineView=function(e){scheduler._merge(e,{section_autoheight:!0,name:"matrix",x:"time",y:"time",x_step:1,x_unit:"hour",y_unit:"day",y_step:1,x_start:0,x_size:24,y_start:0,y_size:7,render:"cell",dx:200,dy:50,event_dy:scheduler.xy.bar_height-5,event_min_dy:scheduler.xy.bar_height-5,resize_events:!0,fit_events:!0,show_unassigned:!1,second_scale:!1,round_position:!1,_logic:function(e,t,s){var r={};return scheduler.checkEvent("onBeforeViewRender")&&(r=scheduler.callEvent("onBeforeViewRender",[e,t,s])),r}}),e._original_x_start=e.x_start,scheduler.checkEvent("onTimelineCreated")&&scheduler.callEvent("onTimelineCreated",[e]);var t=scheduler.render_data;scheduler.render_data=function(s,r){if(this._mode!=e.name)return t.apply(this,arguments);if(r&&!e.show_unassigned&&"cell"!=e.render)for(var a=0;a<s.length;a++)this.clear_event(s[a]),this.render_timeline_event.call(this.matrix[this._mode],s[a],!0);else scheduler.renderMatrix.call(e,!0,!0)},scheduler.matrix[e.name]=e,scheduler.templates[e.name+"_cell_value"]=function(e){return e?e.length:""},scheduler.templates[e.name+"_cell_class"]=function(){return""},scheduler.templates[e.name+"_scalex_class"]=function(){return""},scheduler.templates[e.name+"_second_scalex_class"]=function(){return""},scheduler.templates[e.name+"_scaley_class"]=function(){return""},scheduler.templates[e.name+"_scale_label"]=function(e,t){return t},scheduler.templates[e.name+"_tooltip"]=function(e,t,s){return s.text},scheduler.templates[e.name+"_date"]=function(e,t){return e.getDay()==t.getDay()&&t-e<864e5||+e==+scheduler.date.date_part(new Date(t))||+scheduler.date.add(e,1,"day")==+t&&0==t.getHours()&&0==t.getMinutes()?scheduler.templates.day_date(e):e.getDay()!=t.getDay()&&t-e<864e5?scheduler.templates.day_date(e)+" &ndash; "+scheduler.templates.day_date(t):scheduler.templates.week_date(e,t)},scheduler.templates[e.name+"_scale_date"]=scheduler.date.date_to_str(e.x_date||scheduler.config.hour_date),scheduler.templates[e.name+"_second_scale_date"]=scheduler.date.date_to_str(e.second_scale&&e.second_scale.x_date?e.second_scale.x_date:scheduler.config.hour_date),scheduler.date["add_"+e.name]=function(t,s){var r=scheduler.date.add(t,(e.x_length||e.x_size)*s*e.x_step,e.x_unit);if(("minute"==e.x_unit||"hour"==e.x_unit)&&!e.x_length)if(+scheduler.date.date_part(new Date(t))==+scheduler.date.date_part(new Date(r)))e.x_start+=s*e.x_size;else{var a="hour"==e.x_unit?60*e.x_step:e.x_step,l=1440/(e.x_size*a)-1;s>0?e.x_start-=l*e.x_size:e.x_start=l*e.x_size+e.x_start}return r},scheduler.attachEvent("onBeforeTodayDisplayed",function(){return e.x_start=e._original_x_start,!0}),scheduler.date[e.name+"_start"]=function(t){var s=(scheduler.date[e.x_unit+"_start"]||scheduler.date.day_start).call(scheduler.date,t);return scheduler.date.add(s,e.x_step*e.x_start,e.x_unit)},scheduler.attachEvent("onSchedulerResize",function(){return this._mode!=e.name||(scheduler.renderMatrix.call(e,!0,!0),!1)}),scheduler.attachEvent("onOptionsLoad",function(){e.order={},scheduler.callEvent("onOptionsLoadStart",[]);for(var t=0;t<e.y_unit.length;t++)e.order[e.y_unit[t].key]=t;scheduler.callEvent("onOptionsLoadFinal",[]),scheduler._date&&e.name==scheduler._mode&&scheduler.setCurrentView(scheduler._date,scheduler._mode)}),scheduler.callEvent("onOptionsLoad",[e]),scheduler[e.name+"_view"]=function(){scheduler.renderMatrix.apply(e,arguments)};var s=new Date;scheduler.date.add(s,e.x_step,e.x_unit).valueOf(),s.valueOf();scheduler["mouse_"+e.name]=function(t){var s,a=this._drag_event;this._drag_id&&(a=this.getEvent(this._drag_id),this._drag_event._dhx_changed=!0),t.x-=e.dx;for(var l=0,d=0,_=0;d<=this._cols.length-1;d++){var i=this._cols[d];if((l+=i)>t.x){var h=(h=(t.x-(l-i))/i)<0?0:h;break}}for(l=0;_<this._colsS.heights.length&&!((l+=this._colsS.heights[_])>t.y);_++);if(t.fields={},e.y_unit[_]||(_=e.y_unit.length-1),_>=0&&e.y_unit[_]&&(t.section=t.fields[e.y_property]=e.y_unit[_].key,a)&&(a[e.y_property]=t.section),t.x=0,t.force_redraw=!0,t.custom=!0,d>=e._trace_x.length)s=scheduler.date.add(e._trace_x[e._trace_x.length-1],e.x_step,e.x_unit);else{var c=e._trace_x[d+1]?e._trace_x[d+1]:scheduler.date.add(e._trace_x[e._trace_x.length-1],e.x_step,e.x_unit),n=Math.ceil(h*(c-e._trace_x[d]));s=new Date(+e._trace_x[d]+n)}if("move"==this._drag_mode&&this._drag_id&&this._drag_event){a=this.getEvent(this._drag_id);var u=this._drag_event;u._move_delta||(u._move_delta=(a.start_date-s)/6e4),s=scheduler.date.add(s,u._move_delta,"minute")}if("resize"==this._drag_mode&&a&&(t.resize_from_start=!!(Math.abs(a.start_date-s)<Math.abs(a.end_date-s))),e.round_position)switch(this._drag_mode){case"move":s=r.call(e,s,!1),"day"==e.x_unit&&(t.custom=!1);break;case"resize":this._drag_event&&(null==this._drag_event._resize_from_start&&(this._drag_event._resize_from_start=t.resize_from_start),t.resize_from_start=this._drag_event._resize_from_start,s=r.call(e,s,!this._drag_event._resize_from_start))}return t.y=Math.round((s-this._min_date)/(6e4*this.config.time_step)),t.shift=this.config.time_step,t}},scheduler.render_timeline_event=function(e,t){var r=e[this.y_property];if(!r)return"";var a=e._sorder,l=s(e,!1,this),d=s(e,!0,this),_=this.event_dy;"full"==this.event_dy&&(_=this.section_autoheight?this._section_height[r]-6:this.dy-3),this.resize_events&&(_=Math.max(Math.floor(_/e._count),this.event_min_dy));var i=_-2;!e._inner&&"full"==this.event_dy&&(i=(i+2)*(e._count-a)-2);var h=2+a*_+(a?2*a:0);scheduler.config.cascade_event_display&&(h=2+a*scheduler.config.cascade_event_margin+(a?2*a:0));var c=_+h+2;(!this._events_height[r]||this._events_height[r]<c)&&(this._events_height[r]=c);var n="dhx_cal_event_line "+((n=scheduler.templates.event_class(e.start_date,e.end_date,e))||""),u=e.color?"background:"+e.color+";":"",o=e.textColor?"color:"+e.textColor+";":"",x=scheduler.templates.event_bar_text(e.start_date,e.end_date,e),m='<div event_id="'+e.id+'" class="'+n+'" style="'+u+o+"position:absolute; top:"+h+"px; height: "+i+"px; left:"+l+"px; width:"+Math.max(0,d-l)+"px;"+(e._text_style||"")+'">';if(scheduler.config.drag_resize&&!scheduler.config.readonly){var f="dhx_event_resize";m+="<div class='"+f+" "+f+"_start' style='height: "+i+"px;'></div><div class='"+f+" "+f+"_end' style='height: "+i+"px;'></div>"}if(m+=x+"</div>",!t)return m;var v=document.createElement("DIV");v.innerHTML=m;var g=this.order[r],p=scheduler._els.dhx_cal_data[0].firstChild.rows[g].cells[1].firstChild;scheduler._rendered.push(v.firstChild),p.appendChild(v.firstChild)},scheduler.renderMatrix=function(e,t){if(t||(scheduler._els.dhx_cal_data[0].scrollTop=0),scheduler._min_date=scheduler.date[this.name+"_start"](scheduler._date),scheduler._max_date=scheduler.date.add(scheduler._min_date,this.x_size*this.x_step,this.x_unit),scheduler._table_view=!0,this.second_scale&&(e&&!this._header_resized&&(this._header_resized=scheduler.xy.scale_height,scheduler.xy.scale_height*=2,scheduler._els.dhx_cal_header[0].className+=" dhx_second_cal_header"),!e&&this._header_resized)){scheduler.xy.scale_height/=2,this._header_resized=!1;var s=scheduler._els.dhx_cal_header[0];s.className=s.className.replace(/ dhx_second_cal_header/gi,"")}i.call(this,e)},scheduler._locate_cell_timeline=function(e){for(var t=(e=e||event).target?e.target:e.srcElement,s={},r=scheduler.matrix[scheduler._mode],a=scheduler.getActionData(e),l=0;l<r._trace_x.length-1&&!(+a.date<r._trace_x[l+1]);l++);s.x=l,s.y=r.order[a.section];var d=scheduler._isRender("cell")?1:0;s.src=r._scales[a.section]?r._scales[a.section].getElementsByTagName("td")[l+d]:null;for(var _=!1;0==s.x&&"dhx_cal_data"!=t.className&&t.parentNode;){if("dhx_matrix_scell"==t.className.split(" ")[0]){_=!0;break}t=t.parentNode}return _&&(s.x=-1,s.src=t,s.scale=!0),s};var x=scheduler._click.dhx_cal_data;scheduler._click.dhx_marked_timespan=scheduler._click.dhx_cal_data=function(e){var t=x.apply(this,arguments),s=scheduler.matrix[scheduler._mode];if(s){var r=scheduler._locate_cell_timeline(e);r&&(r.scale?scheduler.callEvent("onYScaleClick",[r.y,s.y_unit[r.y],e||event]):scheduler.callEvent("onCellClick",[r.x,r.y,s._trace_x[r.x],(s._matrix[r.y]||{})[r.x]||[],e||event]))}return t},scheduler.dblclick_dhx_marked_timespan=scheduler.dblclick_dhx_matrix_cell=function(e){var t=scheduler.matrix[scheduler._mode];if(t){var s=scheduler._locate_cell_timeline(e);s&&(s.scale?scheduler.callEvent("onYScaleDblClick",[s.y,t.y_unit[s.y],e||event]):scheduler.callEvent("onCellDblClick",[s.x,s.y,t._trace_x[s.x],(t._matrix[s.y]||{})[s.x]||[],e||event]))}},scheduler.dblclick_dhx_matrix_scell=function(e){return scheduler.dblclick_dhx_matrix_cell(e)},scheduler._isRender=function(e){return scheduler.matrix[scheduler._mode]&&scheduler.matrix[scheduler._mode].render==e},scheduler.attachEvent("onCellDblClick",function(e,t,s,r,a){if(!this.config.readonly&&("dblclick"!=a.type||this.config.dblclick_create)){var l=scheduler.matrix[scheduler._mode],d={};d.start_date=l._trace_x[e],d.end_date=l._trace_x[e+1]?l._trace_x[e+1]:scheduler.date.add(l._trace_x[e],l.x_step,l.x_unit),d[l.y_property]=l.y_unit[t].key,scheduler.addEventNow(d,null,a)}}),scheduler.attachEvent("onBeforeDrag",function(){return!scheduler._isRender("cell")}),scheduler.attachEvent("onEventChanged",function(e,t){t._timed=this.is_one_day_event(t)});var m=scheduler._render_marked_timespan;scheduler._render_marked_timespan=function(e,t,r){if(!scheduler.config.display_marked_timespans)return[];if(!scheduler.matrix||!scheduler.matrix[scheduler._mode])return m.apply(scheduler,[e,t,r]);if(!scheduler._isRender("cell")){var a=scheduler.matrix[scheduler._mode],l=[],d=[],_=[];if(r)_=[t],d=[r];else{var i,h=a.order;for(i in h)h.hasOwnProperty(i)&&(d.push(i),_.push(a._scales[i]))}var c=scheduler._min_date,n=scheduler._max_date,u=[];if(e.days>6){var o=new Date(e.days);scheduler.date.date_part(new Date(c))<=+o&&+n>=+o&&u.push(o)}else u.push.apply(u,scheduler._get_dates_by_index(e.days));for(var x=e.zones,f=scheduler._get_css_classes_by_config(e),v=0;v<d.length;v++){t=_[v],r=d[v];for(var g=0;g<u.length;g++)for(var p=u[g],y=0;y<x.length;y+=2){var k=x[y],b=x[y+1],w=new Date(+p+6e4*k),E=new Date(+p+6e4*b);if(scheduler._min_date<E&&scheduler._max_date>w){var z=scheduler._get_block_by_config(e);z.className=f;var C=s({start_date:w},!1,a)-1,D=s({start_date:E},!1,a)-1,N=Math.max(1,D-C-1),M=a._section_height[r]-1;z.style.cssText="height: "+M+"px; left: "+C+"px; width: "+N+"px; top: 0;",t.insertBefore(z,t.firstChild),l.push(z)}}}return l}};var f=scheduler._append_mark_now;scheduler._append_mark_now=function(e,t){if(scheduler.matrix&&scheduler.matrix[scheduler._mode]){var s=scheduler._currentDate(),r=scheduler._get_zone_minutes(s),a={days:+scheduler.date.date_part(s),zones:[r,r+1],css:"dhx_matrix_now_time",type:"dhx_now_time"};return scheduler._render_marked_timespan(a)}return f.apply(scheduler,[e,t])},scheduler.attachEvent("onScaleAdd",function(e,t){var s=scheduler._marked_timespans;if(s&&scheduler.matrix&&scheduler.matrix[scheduler._mode])for(var r=scheduler._mode,a=scheduler._min_date,l=scheduler._max_date,d=s.global,_=scheduler.date.date_part(new Date(a));_<l;_=scheduler.date.add(_,1,"day")){var i=+_,h=_.getDay(),c=[],n=d[i]||d[h];if(c.push.apply(c,scheduler._get_configs_to_render(n)),s[r]&&s[r][t]){var u=scheduler._get_types_to_render(s[r][t][h],s[r][t][i]);c.push.apply(c,scheduler._get_configs_to_render(u))}for(var o=0;o<c.length;o++){var x=c[o],m=x.days;m<7?(m=i,scheduler._render_marked_timespan(x,e,t),m=h):scheduler._render_marked_timespan(x,e,t)}}})}();