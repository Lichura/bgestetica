!function(){function e(){for(var e=scheduler.getEvents(scheduler._min_date,scheduler._max_date),t=[],l=0;l<this.y_unit.length;l++)t[l]=[];t[s]||(t[s]=[]);for(var l=0;l<e.length;l++){for(var s=this.order[e[l][this.y_property]],r=0;this._trace_x[r+1]&&e[l].start_date>=this._trace_x[r+1];)r++;for(;this._trace_x[r]&&e[l].end_date>this._trace_x[r];)t[s][r]||(t[s][r]=[]),t[s][r].push(e[l]),r++}return t}function t(e,t,l){var s=0,r=t?e.end_date:e.start_date;r.valueOf()>scheduler._max_date.valueOf()&&(r=scheduler._max_date);var d=r-scheduler._min_date_timeline;if(0>d)h=0;else{var a=Math.round(d/(l*scheduler._cols[0]));a>scheduler._cols.length&&(a=scheduler._cols.length);for(var i=0;a>i;i++)s+=scheduler._cols[i];var c=scheduler.date.add(scheduler._min_date_timeline,scheduler.matrix[scheduler._mode].x_step*a,scheduler.matrix[scheduler._mode].x_unit);d=r-c;var h=Math.floor(d/l)}return s+=t?h-14:h+1}function l(t){var l="<table style='table-layout:fixed;' cellspacing='0' cellpadding='0'>",s=[];if(!scheduler._load_mode||!scheduler._load()){if("cell"==this.render)s=e.call(this);else for(var r=scheduler.getEvents(scheduler._min_date,scheduler._max_date),d=0;d<r.length;d++){var a=this.order[r[d][this.y_property]];s[a]||(s[a]=[]),s[a].push(r[d])}for(var i=0,c=0;c<scheduler._cols.length;c++)i+=scheduler._cols[c];var h=new Date;h=(scheduler.date.add(h,this.x_step*this.x_size,this.x_unit)-h)/i,this._step=h,this._summ=i;for(var _=scheduler._colsS.heights=[],c=0;c<this.y_unit.length;c++){var n=this._logic(this.render,this.y_unit[c],this);if(scheduler._merge(n,{height:this.dy}),this.section_autoheight&&this.y_unit.length*n.height<t.offsetHeight&&(n.height=Math.max(n.height,Math.floor((t.offsetHeight-1)/this.y_unit.length))),scheduler._merge(n,{tr_className:"",style_height:"height:"+n.height+"px;",style_width:"width:"+(this.dx-1)+"px;",td_className:"dhx_matrix_scell "+scheduler.templates[this.name+"_scaley_class"](this.y_unit[c].key,this.y_unit[c].label,this),td_content:scheduler.templates[this.name+"_scale_label"](this.y_unit[c].key,this.y_unit[c].label,this),summ_width:"width:"+i+"px;",table_className:""}),l+="<tr class='"+n.tr_className+"' style='"+n.style_height+"'><td class='"+n.td_className+"' style='"+n.style_width+"'>"+n.td_content+"</td>","cell"==this.render)for(var d=0;d<scheduler._cols.length;d++)l+="<td class='dhx_matrix_cell "+scheduler.templates[this.name+"_cell_class"](s[c][d],this._trace_x[d],this.y_unit[c])+"' style='width:"+(scheduler._cols[d]-1)+"px'><div style='width:"+(scheduler._cols[d]-1)+"px'>"+scheduler.templates[this.name+"_cell_value"](s[c][d])+"<div></td>";else{if(l+="<td><div style='"+n.summ_width+" "+n.style_height+" position:relative;' class='dhx_matrix_line'>",s[c]){s[c].sort(function(e,t){return e.start_date>t.start_date?1:-1});for(var u=[],d=0;d<s[c].length;d++){for(var o=s[c][d],m=0;u[m]&&u[m].end_date>o.start_date;)m++;u[m]=o,l+=scheduler.render_timeline_event.call(this,o,m)}}l+="<table class='"+n.table_className+"' cellpadding='0' cellspacing='0' style='"+n.summ_width+" "+n.style_height+"' >";for(var d=0;d<scheduler._cols.length;d++)l+="<td class='dhx_matrix_cell "+scheduler.templates[this.name+"_cell_class"](s[c],this._trace_x[d],this.y_unit[c])+"' style='width:"+(scheduler._cols[d]-1)+"px'><div style='width:"+(scheduler._cols[d]-1)+"px'><div></td>";l+="</table>",l+="</div></td>"}l+="</tr>"}l+="</table>",this._matrix=s,t.scrollTop=0,t.innerHTML=l,scheduler._rendered=[];for(var x=document.getElementsByTagName("DIV"),c=0;c<x.length;c++)x[c].getAttribute("event_id")&&scheduler._rendered.push(x[c]);for(var c=0;c<t.firstChild.rows.length;c++)_.push(t.firstChild.rows[c].offsetHeight)}}function s(e){e.innerHTML="<div></div>",e=e.firstChild,scheduler._cols=[],scheduler._colsS={height:0},this._trace_x=[],scheduler._min_date_timeline=scheduler._min_date;for(var t=scheduler._min_date,l=scheduler._x-this.dx-18,s=this.dx,r=0;r<this.x_size;r++){scheduler._cols[r]=Math.floor(l/(this.x_size-r)),this._trace_x[r]=new Date(t),scheduler._render_x_header(r,s,t,e);var d=scheduler.templates[this.name+"_scalex_class"](t);d&&(e.lastChild.className+=" "+d),t=scheduler.date.add(t,this.x_step,this.x_unit),l-=scheduler._cols[r],s+=scheduler._cols[r]}var a=this._trace_x;e.onclick=function(e){var t=h(e);t&&scheduler.callEvent("onXScaleClick",[t.x,a[t.x],e||event])},e.ondblclick=function(e){var t=h(e);t&&scheduler.callEvent("onXScaleDblClick",[t.x,a[t.x],e||event])}}function r(e){if(e){scheduler.set_sizes(),i();var t=scheduler._min_date;s.call(this,scheduler._els.dhx_cal_header[0]),l.call(this,scheduler._els.dhx_cal_data[0]),scheduler._min_date=t,scheduler._els.dhx_cal_date[0].innerHTML=scheduler.templates[this.name+"_date"](scheduler._min_date,scheduler._max_date),scheduler._table_view=!0}}function d(){scheduler._tooltip&&(scheduler._tooltip.style.display="none",scheduler._tooltip.date="")}function a(e,t,l){if("cell"==e.render){var s=t.x+"_"+t.y,r=e._matrix[t.y][t.x];if(!r)return d();if(r.sort(function(e,t){return e.start_date>t.start_date?1:-1}),scheduler._tooltip){if(scheduler._tooltip.date==s)return;scheduler._tooltip.innerHTML=""}else{var a=scheduler._tooltip=document.createElement("DIV");a.className="dhx_tooltip",document.body.appendChild(a),a.onclick=scheduler._click.dhx_cal_data}for(var i="",c=0;c<r.length;c++)i+="<div class='dhx_tooltip_line' event_id='"+r[c].id+"'>",i+="<div class='dhx_tooltip_date'>"+(r[c]._timed?scheduler.templates.event_date(r[c].start_date):"")+"</div>",i+="<div class='dhx_event_icon icon_details'>&nbsp;</div>",i+=scheduler.templates[e.name+"_tooltip"](r[c].start_date,r[c].end_date,r[c])+"</div>";scheduler._tooltip.style.display="",scheduler._tooltip.style.top="0px",document.body.offsetWidth-l.left-scheduler._tooltip.offsetWidth<0?scheduler._tooltip.style.left=l.left-scheduler._tooltip.offsetWidth+"px":scheduler._tooltip.style.left=l.left+t.src.offsetWidth+"px",scheduler._tooltip.date=s,scheduler._tooltip.innerHTML=i,document.body.offsetHeight-l.top-scheduler._tooltip.offsetHeight<0?scheduler._tooltip.style.top=l.top-scheduler._tooltip.offsetHeight+t.src.offsetHeight+"px":scheduler._tooltip.style.top=l.top+"px"}}function i(){dhtmlxEvent(scheduler._els.dhx_cal_data[0],"mouseover",function(e){var t=scheduler.matrix[scheduler._mode];if(t){var l=scheduler._locate_cell_timeline(e),e=e||event;e.target||e.srcElement;if(l)return a(t,l,getOffset(l.src))}d()}),i=function(){}}function c(e){for(var t=e.parentNode.childNodes,l=0;l<t.length;l++)if(t[l]==e)return l;return-1}function h(e){e=e||event;for(var t=e.target?e.target:e.srcElement;t&&"DIV"!=t.tagName;)t=t.parentNode;if(t&&"DIV"==t.tagName){var l=t.className.split(" ")[0];if("dhx_scale_bar"==l)return{x:c(t),y:-1,src:t,scale:!0}}}scheduler.matrix={},scheduler._merge=function(e,t){for(var l in t)"undefined"==typeof e[l]&&(e[l]=t[l])},scheduler.createTimelineView=function(e){scheduler._merge(e,{section_autoheight:!0,name:"matrix",x:"time",y:"time",x_step:1,x_unit:"hour",y_unit:"day",y_step:1,x_start:0,x_size:24,y_start:0,y_size:7,render:"cell",dx:200,dy:50,_logic:function(e,t,l){var s={};return scheduler.checkEvent("onBeforeViewRender")&&(s=scheduler.callEvent("onBeforeViewRender",[e,t,l])),s}}),scheduler.checkEvent("onTimelineCreated")&&scheduler.callEvent("onTimelineCreated",[e]),scheduler[e.name+"_view"]=function(){scheduler.renderMatrix.apply(e,arguments)};var t=scheduler.render_data;if(scheduler.render_data=function(l,s){if(this._mode!=e.name)return t.apply(this,arguments);if(s)for(var d=0;d<l.length;d++)this.clear_event(l[d]),this.render_timeline_event.call(this.matrix[this._mode],l[d],0,!0);else r.call(e,!0)},scheduler.matrix[e.name]=e,scheduler.templates[e.name+"_cell_value"]=function(e){return e?e.length:""},scheduler.templates[e.name+"_cell_class"]=function(){return""},scheduler.templates[e.name+"_scalex_class"]=function(){return""},scheduler.templates[e.name+"_scaley_class"]=function(){return"class"},scheduler.templates[e.name+"_scale_label"]=function(e,t){return t},scheduler.templates[e.name+"_tooltip"]=function(e,t,l){return l.text},scheduler.templates[e.name+"_date"]=function(e,t){return e.getDay()==t.getDay()&&864e5>e-t?scheduler.templates.day_date(e):scheduler.templates.week_date(e,t)},scheduler.templates[e.name+"_scale_date"]=scheduler.date.date_to_str(e.x_date||scheduler.config.hour_date),scheduler.date["add_"+e.name]=function(t,l){return scheduler.date.add(t,(e.x_length||e.x_size)*l*e.x_step,e.x_unit)},scheduler.date[e.name+"_start"]=scheduler.date[e.x_unit+"_start"]||scheduler.date.day_start,scheduler.attachEvent("onSchedulerResize",function(){return this._mode==e.name?(r.call(e,!0),!1):!0}),scheduler.attachEvent("onOptionsLoad",function(){e.order={};for(var t=0;t<e.y_unit.length;t++)e.order[e.y_unit[t].key]=t;e.name==scheduler._mode&&scheduler._date&&scheduler.setCurrentView(scheduler._date,scheduler._mode)}),scheduler.callEvent("onOptionsLoad",[e]),"cell"!=e.render){var l=new Date,s=scheduler.date.add(l,1,e.x_unit).valueOf()-l.valueOf();scheduler["mouse_"+e.name]=function(t){var l=this._drag_event;this._drag_id&&(l=this.getEvent(this._drag_id),this._drag_event._dhx_changed=!0),t.x-=e.dx;var r=0,d=0,a=0;for(d;d<this._cols.length-1&&(r+=this._cols[d],!(r>t.x));d++);for(r=0,a;a<this._colsS.heights.length&&(r+=this._colsS.heights[a],!(r>t.y));a++);if(t.fields={},t.fields[e.y_property]=l[e.y_property]=e.y_unit[a].key,t.x=a/1e7,"new-size"==this._drag_mode&&1*l.start_date==1*this._drag_start&&d++,d>=e._trace_x.length)var i=scheduler.date.add(e._trace_x[e._trace_x.length-1],e.x_step,e.x_unit);else var i=e._trace_x[d];return t.y=Math.round((i-this._min_date)/(6e4*this.config.time_step)),t.custom=!0,t.shift=s,t}}},scheduler.render_timeline_event=function(e,l,s){var r=t(e,!1,this._step),d=t(e,!0,this._step),a=scheduler.xy.bar_height,i=2+l*a,c=scheduler.templates.event_class(e.start_date,e.end_date,e);c="dhx_cal_event_line "+(c||"");var h='<div event_id="'+e.id+'" class="'+c+'" style="position:absolute; top:'+i+"px; left:"+r+"px; width:"+Math.max(0,d-r)+"px;"+(e._text_style||"")+'">'+scheduler.templates.event_bar_text(e.start_date,e.end_date,e)+"</div>";if(!s)return h;var _=document.createElement("DIV");_.innerHTML=h;var n=this.order[e[this.y_property]],u=scheduler._els.dhx_cal_data[0].firstChild.rows[n].cells[1].firstChild;scheduler._rendered.push(_.firstChild),u.appendChild(_.firstChild)},scheduler.renderMatrix=function(e){var t=scheduler.date[this.name+"_start"](scheduler._date);scheduler._min_date=scheduler.date.add(t,this.x_start*this.x_step,this.x_unit),scheduler._max_date=scheduler.date.add(scheduler._min_date,this.x_size*this.x_step,this.x_unit),scheduler._table_view=!0,r.call(this,e)},scheduler._locate_cell_timeline=function(e){e=e||event;for(var t=e.target?e.target:e.srcElement;t&&"TD"!=t.tagName;)t=t.parentNode;if(t&&"TD"==t.tagName){var l=t.className.split(" ")[0];if("dhx_matrix_cell"==l){if(scheduler._isRender("cell"))return{x:t.cellIndex-1,y:t.parentNode.rowIndex,src:t};for(var s=t.parentNode;s&&"TD"!=s.tagName;)s=s.parentNode;return{x:t.cellIndex,y:s.parentNode.rowIndex,src:t}}if("dhx_matrix_scell"==l)return{x:-1,y:t.parentNode.rowIndex,src:t,scale:!0}}return!1};var _=scheduler._click.dhx_cal_data;scheduler._click.dhx_cal_data=function(e){var t=_.apply(this,arguments),l=scheduler.matrix[scheduler._mode];if(l){var s=scheduler._locate_cell_timeline(e);s&&(s.scale?scheduler.callEvent("onYScaleClick",[s.y,l.y_unit[s.y],e||event]):scheduler.callEvent("onCellClick",[s.x,s.y,l._trace_x[s.x],(l._matrix[s.y]||{})[s.x]||[],e||event]))}return t},scheduler.dblclick_dhx_matrix_cell=function(e){var t=scheduler.matrix[scheduler._mode];if(t){var l=scheduler._locate_cell_timeline(e);l&&(l.scale?scheduler.callEvent("onYScaleDblClick",[l.y,t.y_unit[l.y],e||event]):scheduler.callEvent("onCellDblClick",[l.x,l.y,t._trace_x[l.x],(t._matrix[l.y]||{})[l.x]||[],e||event]))}},scheduler.dblclick_dhx_matrix_scell=function(e){return scheduler.dblclick_dhx_matrix_cell(e)},scheduler._isRender=function(e){return scheduler.matrix[scheduler._mode]&&scheduler.matrix[scheduler._mode].render==e},scheduler.attachEvent("onCellDblClick",function(e,t,l,s,r){if(!this.config.readonly&&("dblclick"!=r.type||this.config.dblclick_create)){var d=scheduler.matrix[scheduler._mode],a={};a.start_date=d._trace_x[e],a.end_date=d._trace_x[e+1]?d._trace_x[e+1]:scheduler.date.add(d._trace_x[e],d.x_step,d.x_unit),a[scheduler.matrix[scheduler._mode].y_property]=d.y_unit[t].key,scheduler.addEventNow(a,null,r)}}),scheduler.attachEvent("onBeforeDrag",function(){return!scheduler._isRender("cell")})}();