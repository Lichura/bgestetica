
  <div class="search_button">
      <img src=<%= asset_path('search-icon.png') %>/>
      <div class"search_button_campos">
        <input id="search_nombre" type="text" name="nombre" placeholder="nombre"></input>
        <input type="text" name="mail" placeholder="mail"></input>
        <input type="text" name="dni" placeholder="dni"></input>
        <button onclick="search_button()">enviar</button>
        <button onclick="clean_button()">borrar</button>
      </div>
   </div>
<div id="scheduler_here" class="dhx_cal_container" style='width:100%; height:500px;'>
 <div class="dhx_cal_navline">
        <div class="dhx_cal_prev_button">&nbsp;</div>
        <div class="dhx_cal_next_button">&nbsp;</div>
        <div class="dhx_cal_today_button"></div>
        <div class="dhx_cal_date"></div>
        <div class="dhx_cal_tab" name="day_tab" style="right:204px;"></div>
        <div class="dhx_cal_tab" name="week_tab" style="right:140px;"></div>
        <div class="dhx_cal_tab" name="month_tab" style="right:76px;"></div>







<div class="dhx_cal_prev_button">&nbsp;</div>
   <div class="dhx_cal_next_button">&nbsp;</div>
   <div class="dhx_cal_today_button"></div>
   <div class="dhx_cal_date"></div>
   <div class="dhx_cal_tab" name="day_tab" style="right:204px;"></div>
   <div class="dhx_cal_tab" name="week_tab" style="right:140px;"></div>
   <div class="dhx_cal_tab" name="month_tab" style="right:76px;"></div>
   <div class="dhx_cal_tab" name="agenda_tab" style="right: 280px;"></div>
   <div class="dhx_cal_tab" name="equipos_tab" style="right:350px;"></div>
   <div class="dhx_cal_tab" name="medicos_tab" style="right:350px;"></div>
 </div>
 <div class="dhx_cal_header">
 </div>
 <div class="dhx_cal_data">
 </div>
</div>

<div id="overlay">
  <div>
    <%= render 'users/form' %>
    <a href='#' onclick="overlay()" class= "btn btn-default">Cerrar</a>
  </div>
</div>

<script>

    scheduler.config.multi_day = true;
    scheduler.config.xml_date="%Y-%m-%d %H:%i";
    scheduler.init("scheduler_here");
    scheduler.config.show_loading = true;
    scheduler.load("<%= data_path %>", "json");
    scheduler.updateView();
    var dp = new dataProcessor("<%= db_action_path %>");
    dp.init(scheduler);
    dp.setTransactionMode("GET", false);
    scheduler.config.first_hour = 8;
    scheduler.config.last_hour = 22;
    scheduler.config.time_step  = 30;


    //buscar por usuario
    function search_button(){
      var user_input = document.getElementById("search_nombre").value;
      scheduler.filter_month = scheduler.filter_day = scheduler.filter_week = function(id, event){
        if(event.equipo == user_input){
          return true;
        }
      };
      scheduler.updateView();
    };

    function clean_button(){
      scheduler.filter_week = function(id, event){return true;};
      scheduler.updateView();
    };

    //Boton de agregar nuevo usuario
    scheduler.locale.labels.button_new="nuevo";
    scheduler.form_blocks.textarea.button_click=function(index,button,shead,sbody){
    modal = document.getElementById('overlay');
    modal.style.visibility = (modal.style.visibility == 'visible') ? "hidden" : "visible";
    scheduler.hideCover();
    };

    function overlay(){
          modal = document.getElementById('overlay');
    modal.style.visibility = (modal.style.visibility == 'visible') ? "hidden" : "visible";
    };

    //load data para los combobox
    var medicos_opts = [];

    <% @medicos.each do |medico| %>
        var nuevo_medico = {}
        nuevo_medico.key = <%= medico.id %>
        nuevo_medico.label = '<%= medico.name + ' ' + medico.lastname %>'
        medicos_opts.push(nuevo_medico)
    <% end %>

    var equipos = []

    <% @equipos_todos.each do |equipo| %>
        var nuevo_equipo = {}
        nuevo_equipo.key = <%= equipo.id %>
        nuevo_equipo.label = '<%= equipo.nombre %>' 
        equipos.push(nuevo_equipo)
    <% end %>

    var pacientes = []
    <% @pacientes.each do |paciente| %>
      var nuevo_paciente = {}
      nuevo_paciente.key = <%= paciente.id %>
      nuevo_paciente.label = "<%= paciente.name + ' ' + paciente.lastname + ' ' + paciente.email %>"
      pacientes.push(nuevo_paciente) 
    <% end %>

    // Modificar colores por equipo


    // Tab de equipos
    scheduler.locale.labels.agenda_tab = "Agenda";
    scheduler.locale.labels.equipos_tab = "Equipo";
    scheduler.locale.labels.medicos_tab = "Medico";


    //equipos vista
    scheduler.createTimelineView({
      name:"equipos", //Nombre de la vista
      x_unit: "minute", //Unidad de medida de la vista
      x_date: "%H:%i",  //
      x_step: 30, // Salta de 30 minutos en 30 minutos
      x_size: 24, // el numero de intervalos mostrados (en este caso 12 horas)
      x_start: 16, // Desde que hora arranca por steps, en este caso a las 8am
      x_lenght: 48, //la longitud del d√≠a, en este caso 48 steps de 30 minutos
      y_unit: equipos, //la info para llenar
      y_property: "equipo", //el campo que tiene en cuenta para llenar
      render: "bar"  //el modo de mostrar la vista
    });

        scheduler.createTimelineView({
      name:"medicos",
      x_unit: "minute",
      x_date: "%H:%i",
      x_step: 30,
      x_size: 24,
      x_start: 16,
      x_lenght: 48,
      y_unit: medicos_opts,
      y_property: "medico",
      render: "bar"
    });





    //secciones del lightbox
    scheduler.config.lightbox.sections=[
      { name:"Paciente", map_to:"paciente", options:pacientes, type:"combo",  image_path:"../dhtmlxCombo/", height:40, filtering:true},
      {name:"Medico",height:20, type:"select", options:medicos_opts, map_to:"medico"},
      {name:"Equipo",height:20, type:"select", options:equipos, map_to:"equipo"},
      {name:"time",height:20, type: "time", map_to: "auto"},
      {name:"estado", height: 20, type:"radio", map_to: "estado",
          options:[{key:1, label:"activo"},
                  {key: 2, label:"completado"}, 
                  {key: 3, label:"cancelado"}]},
      {name:"comentarios", height: 60, map_to:"text", type: "textarea", focus:true, button: "new"},
      {name:"recurring", height:115, type:"recurring", map_to:"rec_type", 
    button:"recurring"},
    ];

</script>
